<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>VigiSensor - Coleta de Dados Mobile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEyAiggQthZ3AibDKDY9UNBoypYYamKBo&libraries=places"></script>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body { 
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .icon {
            width: 18px;
            height: 18px;
            display: inline-block;
            vertical-align: middle;
        }
        .icon-lg {
            width: 24px;
            height: 24px;
        }
        .icon-xl {
            width: 32px;
            height: 32px;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .button-primary {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        .button-success {
            background: linear-gradient(45deg, #059669, #10b981);
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
        }
        .button-danger {
            background: linear-gradient(45deg, #dc2626, #ef4444);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        #map {
            height: 200px;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase Initialization
        const firebaseConfig = {
            apiKey: "AIzaSyBtnU84zOmm9mjwJNf7Sa7g4exGjUI_kj0",
            authDomain: "vigicolera.firebaseapp.com",
            databaseURL: "https://vigicolera-default-rtdb.firebaseio.com",
            projectId: "vigicolera",
            storageBucket: "vigicolera.firebasestorage.app",
            messagingSenderId: "443742285213",
            appId: "1:443742285213:web:ce5c8ef141c46ed2ccd374"
        };

        let firebaseApp;
        if (!firebase.apps.length) {
            firebaseApp = firebase.initializeApp(firebaseConfig);
        } else {
            firebaseApp = firebase.app();
        }
        const database = firebase.database();

        // Reverse Geocoding Function
        const reverseGeocode = async (lat, lng, cache) => {
            const cacheKey = `${lat},${lng}`;
            if (cache[cacheKey]) {
                return cache[cacheKey];
            }
            try {
                const response = await fetch(
                    `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=AIzaSyDEyAiggQthZ3AibDKDY9UNBoypYYamKBo`
                );
                const data = await response.json();
                if (data.status === 'OK' && data.results.length > 0) {
                    const locationName = data.results[0].formatted_address || 'Localização desconhecida';
                    cache[cacheKey] = locationName;
                    return locationName;
                } else {
                    throw new Error(data.error_message || 'Nenhum resultado encontrado');
                }
            } catch (error) {
                console.error('Error reverse geocoding:', error);
                return 'Erro ao obter localização';
            }
        };

        // SVG Icons
        const SensorIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L13.09 8.26L19 7L17.74 13.09L22 12L16.74 18.26L21 19L14.91 15.74L16 22L9.74 16.74L11 21L4.91 14.91L9 16L3.74 9.74L2 11L8.26 4.91L7 3L13.09 6.26L12 2Z"/>
            </svg>
        );

        const MapIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        );

        const ActivityIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
            </svg>
        );

        const WifiIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M5 12.55a11 11 0 0 1 14.08 0"/>
                <path d="M1.42 9a16 16 0 0 1 21.16 0"/>
                <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/>
                <path d="M12 20h.01"/>
            </svg>
        );

        const DatabaseIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
            </svg>
        );

        const SettingsIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        );

        const PlayIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5,3 19,12 5,21"/>
            </svg>
        );

        const StopIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="6" width="12" height="12"/>
            </svg>
        );

        const SendIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"/>
                <polygon points="22,2 15,22 11,13 2,9 22,2"/>
            </svg>
        );

        const UserIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const VigiSensorApp = () => {
            const [isActive, setIsActive] = useState(false);
            const [connectionStatus, setConnectionStatus] = useState('Aguardando');
            const [currentTime, setCurrentTime] = useState(new Date());
            const [location, setLocation] = useState(null);
            const [locationName, setLocationName] = useState('');
            const [error, setError] = useState(null);
            const [watchId, setWatchId] = useState(null);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [agentName, setAgentName] = useState('');
            const [sensorData, setSensorData] = useState({
                temperature: 25.4,
                humidity: 68,
                pressure: 1013.2,
                altitude: 1456,
                battery: 78,
                signal: 'strong'
            });
            const [metrics, setMetrics] = useState({
                totalCases: 0,
                activeCases: 0,
                recovered: 0,
                deaths: 0,
                suspects: 0,
                confirmed: 0
            });
            const mapRef = useRef(null);
            const mapInstance = useRef(null);
            const markersLayer = useRef(null);
            const locationCache = useRef({});

            // Fetch Metrics from Firebase
            useEffect(() => {
                const metricsRef = database.ref('metrics');
                metricsRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        setMetrics({
                            totalCases: Number(data.totalCases) || 0,
                            activeCases: Number(data.activeCases) || 0,
                            recovered: Number(data.recovered) || 0,
                            deaths: Number(data.deaths) || 0,
                            suspects: Number(data.suspects) || 0,
                            confirmed: Number(data.confirmed) || 0
                        });
                    } else {
                        setError('❌ Sem dados de métricas disponíveis');
                    }
                }, (err) => {
                    setError(`❌ Erro ao carregar métricas: ${err.message}`);
                });

                return () => metricsRef.off();
            }, []);

            // Initialize Leaflet Map
            useEffect(() => {
                if (!mapInstance.current) {
                    mapInstance.current = L.map(mapRef.current).setView([-8.8383, 13.2344], 14);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    }).addTo(mapInstance.current);
                    markersLayer.current = L.layerGroup().addTo(mapInstance.current);
                }

                return () => {
                    if (mapInstance.current) {
                        mapInstance.current.remove();
                        mapInstance.current = null;
                    }
                };
            }, []);

            // Update Map with Location
            useEffect(() => {
                if (location && mapInstance.current) {
                    const { lat, lng, accuracy } = location;
                    mapInstance.current.setView([lat, lng], 14);
                    markersLayer.current.clearLayers();

                    // User location marker
                    L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'custom-icon',
                            html: '<div style="background-color: #3b82f6; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;"></div>',
                            iconSize: [20, 20]
                        })
                    })
                        .addTo(markersLayer.current)
                        .bindPopup('Sua localização atual');

                    // Accuracy circle
                    L.circle([lat, lng], {
                        radius: accuracy,
                        color: '#3b82f6',
                        fillColor: '#3b82f6',
                        fillOpacity: 0.1
                    }).addTo(markersLayer.current);

                    // Fetch location name
                    reverseGeocode(lat, lng, locationCache.current)
                        .then(name => setLocationName(name));
                }
            }, [location]);

            // Update Time
            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // Simulate Sensor Data Updates
            useEffect(() => {
                const interval = setInterval(() => {
                    setSensorData(prev => ({
                        ...prev,
                        temperature: (25 + Math.random() * 5).toFixed(1),
                        humidity: Math.floor(65 + Math.random() * 10),
                        pressure: (1010 + Math.random() * 10).toFixed(1),
                        battery: Math.max(0, prev.battery - Math.random() * 0.1)
                    }));
                }, 3000);
                return () => clearInterval(interval);
            }, []);

            // Handle Location Update
            const handleLocationUpdate = (position) => {
                const { latitude, longitude, accuracy } = position.coords;
                setLocation({
                    lat: latitude,
                    lng: longitude,
                    accuracy: accuracy,
                    timestamp: new Date()
                });
                setConnectionStatus('🔄 Conectado');
                setError(null);
            };

            // Handle Location Error
            const handleLocationError = (error) => {
                let errorMessage = '';
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage = "❌ Permissão de localização negada";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage = "GPS de localização indisponível";
                        break;
                    case error.TIMEOUT:
                        errorMessage = "⏱️ Timeout do GPS";
                        break;
                    default:
                        errorMessage = "Erro ao obter localização";
                        break;
                }
                setError(errorMessage);
                setConnectionStatus('Erro GPS');
            };

            // Start Tracking
            const startTracking = () => {
                if (!navigator.geolocation) {
                    setError('❌ GPS não suportado');
                    return;
                }
                const options = {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 60000
                };

                const id = navigator.geolocation.watchPosition(
                    handleLocationUpdate,
                    handleLocationError,
                    options
                );
                setWatchId(id);
                setIsActive(true);
                setConnectionStatus('🔄 Rastreando...');
                setError(null);
            };

            // Stop Tracking
            const stopTracking = () => {
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    setWatchId(null);
                }
                setIsActive(false);
                setConnectionStatus('⏹️ Parado');
            };

            // Get Current Location
            const getCurrentLocation = () => {
                if (!navigator.geolocation) {
                    setError('❌ GPS não suportado');
                    return;
                }
                setConnectionStatus('📍 Obtendo localização...');
                navigator.geolocation.getCurrentPosition(
                    handleLocationUpdate,
                    handleLocationError,
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    }
                );
            };

            // Register Data to Firebase
            const registerData = async () => {
                if (!location) {
                    setError('❌ Localização necessária para registrar dados');
                    return;
                }
                if (!agentName.trim()) {
                    setError('❌ Nome do agente é obrigatório');
                    return;
                }
                setIsSubmitting(true);
                setConnectionStatus('📝 Registrando dados...');
                try {
                    const data = {
                        agentName: agentName.trim(),
                        temperature: Number(sensorData.temperature),
                        humidity: Number(sensorData.humidity),
                        pressure: Number(sensorData.pressure),
                        altitude: Number(sensorData.altitude),
                        gps: {
                            lat: location.lat,
                            lng: location.lng,
                            accuracy: location.accuracy
                        },
                        battery: Math.floor(sensorData.battery),
                        signal: sensorData.signal,
                        timestamp: new Date().toISOString(),
                        dataHora: new Date().toLocaleString('pt-BR', { timeZone: 'Africa/Luanda' })
                    };

                    await database.ref('sensor-readings').push(data);
                    setConnectionStatus('✅ Dados registrados com sucesso');
                    setError(null);
                    setAgentName('');
                    if (navigator.vibrate) {
                        navigator.vibrate([100, 100, 50, 100]);
                    }
                } catch (err) {
                    setError(`❌ Erro ao registrar dados: ${err.message}`);
                    setConnectionStatus('Erro no registro');
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }
                } finally {
                    setIsSubmitting(false);
                }
            };

            // Initial Location Fetch
            useEffect(() => {
                getCurrentLocation();
                return () => {
                    if (watchId) {
                        navigator.geolocation.clearWatch(watchId);
                    }
                };
            }, []);

            return (
                <div className="min-h-screen p-4">
                    {/* Header */}
                    <div className="text-center mb-6 slide-up">
                        <div className="glass-effect rounded-2xl p-6 mb-4">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                <SensorIcon className="icon-xl text-blue-600" />
                                <h1 className="text-2xl font-bold text-gray-800">VigiSensor</h1>
                            </div>
                            <p className="text-gray-600 text-sm">Sistema de Coleta de Dados Mobile</p>
                            <div className="text-xs text-gray-500 mt-2">
                                {currentTime.toLocaleString('pt-BR', { timeZone: 'Africa/Luanda' })}
                            </div>
                        </div>
                    </div>

                    {/* Agent Info */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center gap-2 mb-3">
                            <UserIcon className="icon text-blue-600" />
                            <span className="font-semibold text-gray-700">Dados do Agente</span>
                        </div>
                        <input
                            type="text"
                            placeholder="Nome do agente de campo"
                            value={agentName}
                            onChange={(e) => setAgentName(e.target.value)}
                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-lg"
                            required
                            aria-label="Nome do agente"
                        />
                    </div>

                    {/* Statistics Section */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center gap-2 mb-3">
                            <ActivityIcon className="icon text-blue-600" />
                            <span className="font-semibold text-gray-700">Estatísticas</span>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            <div className="stats-card rounded-xl p-3 text-center">
                                <p className="text-2xl font-bold text-gray-800">{metrics.totalCases}</p>
                                <p className="text-sm text-gray-600">Total de Casos</p>
                            </div>
                            <div className="stats-card rounded-xl p-3 text-center">
                                <p className="text-2xl font-bold text-blue-600">{metrics.activeCases}</p>
                                <p className="text-sm text-gray-600">Casos Ativos</p>
                            </div>
                            <div className="stats-card rounded-xl p-3 text-center">
                                <p className="text-2xl font-bold text-yellow-600">{metrics.suspects}</p>
                                <p className ="text-sm text-gray-600">Suspeitos</p>
                            </div>
                            <div className="stats-card rounded-xl p-3 text-center">
                                <p className="text-2xl font-bold text-red-600">{metrics.confirmed}</p>
                                <p className="text-sm text-gray-600">Confirmados</p>
                            </div>
                            <div className="stats-card rounded-xl p-3 text-center">
                                <p className="text-2xl font-bold text-green-600">{metrics.recovered}</p>
                                <p className="text-sm text-gray-600">Recuperados</p>
                            </div>
                            <div className="stats-card rounded-xl p-3 text-center">
                                <p className="text-2xl font-bold text-red-700">{metrics.deaths}</p>
                                <p className="text-sm text-gray-600">Óbitos</p>
                            </div>
                        </div>
                    </div>

                    {/* Map */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center gap-2 mb-3">
                            <MapIcon className="icon text-blue-600" />
                            <span className="font-semibold text-gray-700">Mapa em Tempo Real</span>
                        </div>
                        <div id="map" ref={mapRef}></div>
                    </div>

                    {/* Status Dashboard */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center justify-between mb-3">
                            <span className="text-sm font-semibold text-gray-700">Status:</span>
                            <ActivityIcon className={`icon-lg ${isActive ? 'text-green-500 pulse-animation' : 'text-gray-400'}`} />
                        </div>
                        <div className={`text-lg font-semibold mb-2 ${
                            connectionStatus.includes('sucesso') ? 'text-green-600' : 
                            connectionStatus.includes('Erro') ? 'text-red-600' : 'text-blue-600'
                        }`}>
                            {connectionStatus}
                        </div>
                    </div>

                    {/* Sensor Readings */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center gap-2 mb-3">
                            <SensorIcon className="icon text-blue-600" />
                            <span className="font-semibold text-gray-700">Leituras do Sensor</span>
                        </div>
                        <div className="space-y-2 text-sm text-gray-600">
                            <div className="flex justify-between">
                                <span>Temperature:</span>
                                <span className="text-lg">{sensorData.temperature}°C</span>
                            </div>
                            <div className="flex justify-between">
                                <span>Humidity:</span>
                                <span className="text-lg">{sensorData.humidity}%</span>
                            </div>
                            <div className="flex justify-between">
                                <span>Pressure:</span>
                                <span className="text-lg">{sensorData.pressure} hPa</span>
                            </div>
                            <div className="flex justify-between">
                                <span>Altitude:</span>
                                <span className="text-lg">{sensorData.altitude} m</span>
                            </div>
                        </div>
                    </div>

                    {/* Location Info */}
                    {location && (
                        <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                            <div className="flex items-center gap-2 mb-3">
                                <MapIcon className="icon text-green-600" />
                                <span className="font-semibold text-gray-700">Localização Atual</span>
                            </div>
                            <div className="text-sm text-gray-600 space-y-2">
                                <div className="flex justify-between">
                                    <span>Local:</span>
                                    <span>{locationName || 'Carregando localização...'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Latitude:</span>
                                    <span className="font-mono">{location.lat.toFixed(6)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Longitude:</span>
                                    <span className="font-mono">{location.lng.toFixed(6)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Precisão:</span>
                                    <span className="font-mono">{location.accuracy?.toFixed(1)} m</span>
                                </div>
                                <div className="text-xs text-gray-500 text-center pt-2">
                                    Atualizado: {location.timestamp.toLocaleString('pt-BR', { timeZone: 'Africa/Luanda' })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* System Info */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center gap-2 mb-3">
                            <DatabaseIcon className="icon text-blue-600" />
                            <span className="font-semibold text-gray-700">Sistema</span>
                            <div className="text-sm text-gray-600 space-y-2">
                                <div className="flex justify-between">
                                    <span>Battery:</span>
                                    <span className="font-mono">{Math.floor(sensorData.battery)}%</span>
                                </div>
                                <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full bg-gradient-to-r from-green-400 to-blue-500"
                                        style={{ width: `${sensorData.battery}%` }}
                                    ></div>
                                </div>
                                <div className="flex justify-between">
                                    <span>Connection:</span>
                                    <span className="flex items-center gap-1">
                                        <WifiIcon className="icon text-blue-600" />
                                        4G - {sensorData.signal}
                                    </span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Database:</span>
                                    <span className="flex items-center gap-1">
                                        <DatabaseIcon className="icon text-blue-600" />
                                        Firebase
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Error Message */}
                    {error && (
                        <div className="glass-effect rounded-2xl p-4 mb-4 border-2 border-red-200 slide-up">
                            <p className="text-red-600 font-medium text-center">{error}</p>
                        </div>
                    )}

                    {/* Register Data Button */}
                    <div className="mb-4 slide-up">
                        <button 
                            disabled={isSubmitting || !location || !agentName.trim()}
                            onClick={registerData}
                            className="w-full button-primary text-white font-semibold rounded-3xl py-3 transition-all duration-300 flex items-center justify-center gap-3 text-lg"
                        >
                            {isSubmitting ? (
                                <svg className="animate-spin h-5 w-5" viewBox="0 24">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                                    <path fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" />
                                </svg>
                            ) : (
                                <SendIcon className="icon-lg" />
                            )}
                            {isSubmitting ? 'Registrando...' : '📊 REGISTRAR DADOS'}
                        </button>
                    </div>

                    {/* Control Buttons */}
                    <div className="grid grid-cols-2 gap-3 mb-6 slide-up">
                        <button 
                            onClick={getCurrentLocation}
                            className="button-primary text-white font-semibold py-4 px-4 rounded-2xl transition-all duration-300 flex items-center justify-center gap-2"
                            aria-label="Obter localização atual"
                        >
                            <MapIcon className="icon" />
                            📍 Obter Localização
                        </button>
                        {!isActive ? (
                            <button
                                onClick={startTracking}
                                className="button-success text-white font-semibold py-4 px-4 rounded-2xl transition-all duration-300 flex items-center justify-center gap-2"
                                aria-label="Iniciar rastreamento"
                            >
                                <PlayIcon className="icon" />
                                ▶️ Iniciar Sensor
                            </button>
                        ) : (
                            <button
                                onClick={stopTracking}
                                className="button-danger text-white font-semibold py-4 px-2 rounded-xl transition-all duration-300 flex items-center justify-center gap-2"
                                aria-label="Parar rastreamento"
                            >
                                <StopIcon className="icon" />
                                ⏸️ Parar Sensor
                            </button>
                        )}
                    </div>

                    {/* Settings Button */}
                    <div className="mb-4 slide-up">
                        <button
                            className="w-full button-primary text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 flex items-center justify-center gap-2"
                            aria-label="Configurações"
                        >
                            <SettingsIcon className="icon" />
                            ⚙️ Configurar
                        </button>
                    </div>

                    {/* Info Footer */}
                    <div className="glass-effect rounded-2xl p-4 slide-up">
                        <h4 className="font-semibold text-gray-700 mb-3">ℹ️ Informações do Sistema</h4>
                        <div className="text-xs text-gray-600 space-y-1">
                            <div>🔥 Base de Dados: Firebase Realtime Database</div>
                            <div>📍 Mapa: OpenStreetMap/Leaflet</div>
                            <div>📍 Geocodificação: Google Maps API</div>
                            <div>📱 Modo: Coleta de Dados Mobile</div>
                            <div>🌍 Foco: Monitoramento Ambiental</div>
                            <div>📅 Data: 20/06/2025</div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<VigiSensorApp />, document.getElementById('root'));
    </script>
</body>
