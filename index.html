<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rastreador de C√≥lera - Mobile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@mui/material@5.15.7/umd/material-ui.development.js"></script>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom right, #121212, #1c2526, #2a2a2a);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const {
            Box, Card, CardContent, Typography, TextField, Select, MenuItem, Button, CircularProgress,
            InputLabel, FormControl, Alert, Grid, IconButton
        } = window['material-ui'];

        const ColeraTracker = () => {
            const [isTracking, setIsTracking] = useState(false);
            const [location, setLocation] = useState(null);
            const [lastSent, setLastSent] = useState(null);
            const [status, setStatus] = useState('Aguardando');
            const [error, setError] = useState(null);
            const [watchId, setWatchId] = useState(null);
            const [caseData, setCaseData] = useState({
                agenteName: '',
                caseType: 'suspeito',
                severity: 'leve',
                status: 'pendente-analise'
            });

            const FIREBASE_URL = 'https://vigicolera-default-rtdb.firebaseio.com/casos-colera.json';

            const sendCaseToFirebase = async (lat, lng, caseInfo) => {
                try {
                    const data = {
                        agente: caseInfo.agenteName || "agente-campo",
                        dispositivo: "mobile-coleta",
                        tipoCaso: caseInfo.caseType,
                        gravidade: caseInfo.severity,
                        status: caseInfo.status,
                        coordenadas: {
                            lat: lat.toString(),
                            lng: lng.toString(),
                            precisao: location?.accuracy || 0
                        },
                        timestamp: new Date().toISOString(),
                        dataHora: new Date().toLocaleString('pt-BR')
                    };

                    const response = await fetch(FIREBASE_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        setLastSent(new Date().toLocaleTimeString('pt-BR'));
                        setStatus('‚úÖ Caso registrado com sucesso');
                        setError(null);
                        if (navigator.vibrate) {
                            navigator.vibrate([100, 50, 100]);
                        }
                    } else {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                } catch (err) {
                    setError(`‚ùå Erro ao registrar: ${err.message}`);
                    setStatus('Erro no registro');
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }
                }
            };

            const handleLocationUpdate = (position) => {
                const { latitude, longitude } = position.coords;
                setLocation({
                    lat: latitude,
                    lng: longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date()
                });
            };

            const handleLocationError = (error) => {
                let errorMessage = '';
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage = "‚ùå Permiss√£o de localiza√ß√£o negada";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage = "‚ùå GPS indispon√≠vel";
                        break;
                    case error.TIMEOUT:
                        errorMessage = "‚è±Ô∏è Timeout do GPS";
                        break;
                    default:
                        errorMessage = "‚ùå Erro desconhecido";
                        break;
                }
                setError(errorMessage);
                setStatus('Erro GPS');
            };

            const startTracking = () => {
                if (!navigator.geolocation) {
                    setError('‚ùå GPS n√£o suportado');
                    return;
                }
                const options = { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 };
                const id = navigator.geolocation.watchPosition(handleLocationUpdate, handleLocationError, options);
                setWatchId(id);
                setIsTracking(true);
                setStatus('üîÑ Rastreando localiza√ß√£o...');
                setError(null);
            };

            const stopTracking = () => {
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    setWatchId(null);
                }
                setIsTracking(false);
                setStatus('‚èπÔ∏è Rastreamento parado');
            };

            const registerCase = () => {
                if (!location) {
                    setError('‚ùå Localiza√ß√£o necess√°ria para registrar caso');
                    return;
                }
                if (!caseData.agenteName.trim()) {
                    setError('‚ùå Nome do agente √© obrigat√≥rio');
                    return;
                }
                setStatus('üìù Registrando caso...');
                sendCaseToFirebase(location.lat, location.lng, caseData);
            };

            const getCurrentLocation = () => {
                if (!navigator.geolocation) {
                    setError('‚ùå GPS n√£o suportado');
                    return;
                }
                setStatus('üìç Obtendo localiza√ß√£o atual...');
                navigator.geolocation.getCurrentPosition(
                    handleLocationUpdate,
                    handleLocationError,
                    { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
                );
            };

            useEffect(() => {
                getCurrentLocation();
                return () => {
                    if (watchId) {
                        navigator.geolocation.clearWatch(watchId);
                    }
                };
            }, []);

            return (
                <Box sx={{ minHeight: '100vh', p: { xs: 2, sm: 3 }, bgcolor: 'transparent' }}>
                    {/* Header */}
                    <Card
                        sx={{
                            bgcolor: '#1c2526',
                            borderRadius: 2,
                            p: 3,
                            mb: 3,
                            boxShadow: '0 4px 16px rgba(0, 0, 0, 0.5)',
                        }}
                    >
                        <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 2, mb: 1 }}>
                            <IconButton sx={{ color: '#ef5350' }}>
                                <span className="material-icons">coronavirus</span>
                            </IconButton>
                            <Typography
                                variant="h5"
                                sx={{
                                    fontWeight: 'bold',
                                    color: '#fff',
                                    background: 'linear-gradient(to right, #ffffff, #e0e0e0)',
                                    WebkitBackgroundClip: 'text',
                                    WebkitTextFillColor: 'transparent',
                                }}
                            >
                                Vigil√¢ncia C√≥lera
                            </Typography>
                        </Box>
                        <Typography variant="body2" sx={{ color: '#b0bec5', textAlign: 'center' }}>
                            Sistema de Coleta de Dados Mobile
                        </Typography>
                    </Card>

                    {/* Status Card */}
                    <Card sx={{ bgcolor: '#1c2526', borderRadius: 2, p: 3, mb: 3, boxShadow: '0 4px 16px rgba(0, 0, 0, 0.5)' }}>
                        <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 2 }}>
                            <Typography variant="subtitle1" sx={{ color: '#fff', fontWeight: 'medium' }}>
                                Status do Sistema:
                            </Typography>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <span
                                    className="material-icons"
                                    style={{
                                        color: isTracking ? '#4caf50' : '#b0bec5',
                                        animation: isTracking ? 'pulse 2s infinite' : 'none',
                                    }}
                                >
                                    timeline
                                </span>
                            </Box>
                        </Box>
                        <Typography
                            variant="h6"
                            sx={{
                                color: status.includes('sucesso') ? '#4caf50' : status.includes('Erro') ? '#ef5350' : '#1976d2',
                                mb: lastSent ? 1 : 0,
                            }}
                        >
                            {status}
                        </Typography>
                        {lastSent && (
                            <Typography variant="caption" sx={{ color: '#b0bec5' }}>
                                √öltimo registro: {lastSent}
                            </Typography>
                        )}
                    </Card>

                    {/* Agent Info */}
                    <Card sx={{ bgcolor: '#1c2526', borderRadius: 2, p: 3, mb: 3, boxShadow: '0 4px 16px rgba(0, 0, 0, 0.5)' }}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>
                            <span className="material-icons" style={{ color: '#1976d2' }}>person</span>
                            <Typography variant="subtitle1" sx={{ color: '#fff', fontWeight: 'medium' }}>
                                Dados do Agente
                            </Typography>
                        </Box>
                        <TextField
                            fullWidth
                            label="Nome do agente de campo"
                            value={caseData.agenteName}
                            onChange={(e) => setCaseData({ ...caseData, agenteName: e.target.value })}
                            variant="outlined"
                            sx={{
                                '& .MuiOutlinedInput-root': {
                                    bgcolor: '#263238',
                                    color: '#fff',
                                    borderRadius: 1,
                                    '& fieldset': { borderColor: 'rgba(255, 255, 255, 0.2)' },
                                    '&:hover fieldset': { borderColor: '#1976d2' },
                                },
                                '& .MuiInputLabel-root': { color: '#b0bec5' },
                            }}
                        />
                    </Card>

                    {/* Case Data */}
                    <Card sx={{ bgcolor: '#1c2526', borderRadius: 2, p: 3, mb: 3, boxShadow: '0 4px 16px rgba(0, 0, 0, 0.5)' }}>
                        <Typography variant="subtitle1" sx={{ color: '#fff', mb: 2, fontWeight: 'medium' }}>
                            üìã Dados do Caso
                        </Typography>
                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                            <FormControl fullWidth>
                                <InputLabel sx={{ color: '#b0bec5' }}>Tipo de Caso</InputLabel>
                                <Select
                                    value={caseData.caseType}
                                    onChange={(e) => setCaseData({ ...caseData, caseType: e.target.value })}
                                    sx={{
                                        bgcolor: '#263238',
                                        color: '#fff',
                                        '& .MuiSvgIcon-root': { color: '#fff' },
                                        '& fieldset': { borderColor: 'rgba(255, 255, 255, 0.2)' },
                                        '&:hover fieldset': { borderColor: '#1976d2' },
                                    }}
                                >
                                    <MenuItem value="suspeito">ü§î Caso Suspeito</MenuItem>
                                    <MenuItem value="confirmado">‚úÖ Caso Confirmado</MenuItem>
                                    <MenuItem value="descartado">‚ùå Caso Descartado</MenuItem>
                                </Select>
                            </FormControl>
                            <FormControl fullWidth>
                                <InputLabel sx={{ color: '#b0bec5' }}>Gravidade</InputLabel>
                                <Select
                                    value={caseData.severity}
                                    onChange={(e) => setCaseData({ ...caseData, severity: e.target.value })}
                                    sx={{
                                        bgcolor: '#263238',
                                        color: '#fff',
                                        '& .MuiSvgIcon-root': { color: '#fff' },
                                        '& fieldset': { borderColor: 'rgba(255, 255, 255, 0.2)' },
                                        '&:hover fieldset': { borderColor: '#1976d2' },
                                    }}
                                >
                                    <MenuItem value="leve">üü¢ Leve</MenuItem>
                                    <MenuItem value="moderado">üü° Moderado</MenuItem>
                                    <MenuItem value="grave">üî¥ Grave</MenuItem>
                                    <MenuItem value="critico">üÜò Cr√≠tico</MenuItem>
                                </Select>
                            </FormControl>
                            <FormControl fullWidth>
                                <InputLabel sx={{ color: '#b0bec5' }}>Status</InputLabel>
                                <Select
                                    value={caseData.status}
                                    onChange={(e) => setCaseData({ ...caseData, status: e.target.value })}
                                    sx={{
                                        bgcolor: '#263238',
                                        color: '#fff',
                                        '& .MuiSvgIcon-root': { color: '#fff' },
                                        '& fieldset': { borderColor: 'rgba(255, 255, 255, 0.2)' },
                                        '&:hover fieldset': { borderColor: '#1976d2' },
                                    }}
                                >
                                    <MenuItem value="pendente-analise">‚è≥ Pendente de An√°lise</MenuItem>
                                    <MenuItem value="ativo">‚úÖ Ativo</MenuItem>
                                    <MenuItem value="descartado">‚ùå Descartado</MenuItem>
                                    <MenuItem value="concluido">‚úîÔ∏è Conclu√≠do</MenuItem>
                                </Select>
                            </FormControl>
                        </Box>
                    </Card>

                    {/* Location Info */}
                    {location && (
                        <Card sx={{ bgcolor: '#1c2526', borderRadius: 2, p: 3, mb: 3, boxShadow: '0 4px 16px rgba(0, 0, 0, 0.5)' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>
                                <span className="material-icons" style={{ color: '#4caf50' }}>location_on</span>
                                <Typography variant="subtitle1" sx={{ color: '#fff', fontWeight: 'medium' }}>
                                    Localiza√ß√£o Atual
                                </Typography>
                            </Box>
                            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1, color: '#b0bec5' }}>
                                <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                                    <Typography variant="body2">Latitude:</Typography>
                                    <Typography variant="body2" sx={{ fontFamily: 'monospace' }}>
                                        {location.lat.toFixed(6)}
                                    </Typography>
                                </Box>
                                <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                                    <Typography variant="body2">Longitude:</Typography>
                                    <Typography variant="body2" sx={{ fontFamily: 'monospace' }}>
                                        {location.lng.toFixed(6)}
                                    </Typography>
                                </Box>
                                <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                                    <Typography variant="body2">Precis√£o:</Typography>
                                    <Typography variant="body2" sx={{ fontFamily: 'monospace' }}>
                                        {location.accuracy?.toFixed(0)}m
                                    </Typography>
                                </Box>
                                <Typography variant="caption" sx={{ color: '#b0bec5', textAlign: 'center', mt: 1 }}>
                                    Atualizado: {location.timestamp.toLocaleString('pt-BR')}
                                </Typography>
                            </Box>
                        </Card>
                    )}

                    {/* Error Message */}
                    {error && (
                        <Alert severity="error" sx={{ mb: 3, bgcolor: '#1c2526', border: '1px solid #ef5350', borderRadius: 2 }}>
                            {error}
                        </Alert>
                    )}

                    {/* Main Action Button */}
                    <Button
                        fullWidth
                        variant="contained"
                        onClick={registerCase}
                        disabled={!location || !caseData.agenteName.trim()}
                        sx={{
                            bgcolor: 'linear-gradient(45deg, #1976d2, #3949ab)',
                            color: '#fff',
                            fontWeight: 'bold',
                            py: 2,
                            borderRadius: 2,
                            mb: 3,
                            boxShadow: '0 4px 15px rgba(0, 0, 0, 0.3)',
                            '&:hover': { bgcolor: 'linear-gradient(45deg, #1565c0, #303f9f)' },
                            '&:disabled': { bgcolor: '#b0bec5', boxShadow: 'none' },
                        }}
                        startIcon={<span className="material-icons">send</span>}
                    >
                        Registrar Caso
                    </Button>

                    {/* GPS Controls */}
                    <Grid container spacing={2} sx={{ mb: 3 }}>
                        <Grid item xs={6}>
                            <Button
                                fullWidth
                                variant="contained"
                                onClick={getCurrentLocation}
                                sx={{
                                    bgcolor: 'linear-gradient(45deg, #1976d2, #3949ab)',
                                    color: '#fff',
                                    py: 2,
                                    borderRadius: 2,
                                    boxShadow: '0 4px 15px rgba(0, 0, 0, 0.3)',
                                    '&:hover': { bgcolor: 'linear-gradient(45deg, #1565c0, #303f9f)' },
                                }}
                                startIcon={<span className="material-icons">location_on</span>}
                            >
                                Localizar
                            </Button>
                        </Grid>
                        <Grid item xs={6}>
                            <Button
                                fullWidth
                                variant="contained"
                                onClick={isTracking ? stopTracking : startTracking}
                                sx={{
                                    bgcolor: isTracking
                                        ? 'linear-gradient(45deg, #d32f2f, #ef5350)'
                                        : 'linear-gradient(45deg, #059669, #10b981)',
                                    color: '#fff',
                                    py: 2,
                                    borderRadius: 2,
                                    boxShadow: '0 4px 15px rgba(0, 0, 0, 0.3)',
                                    '&:hover': {
                                        bgcolor: isTracking
                                            ? 'linear-gradient(45deg, #c62828, #d81b60)'
                                            : 'linear-gradient(45deg, #047857, #0d8c6b)',
                                    },
                                }}
                                startIcon={
                                    <span className="material-icons">{isTracking ? 'stop' : 'play_arrow'}</span>
                                }
                            >
                                {isTracking ? 'Parar' : 'Rastrear'}
                            </Button>
                        </Grid>
                    </Grid>

                    {/* Info Footer */}
                    <Card sx={{ bgcolor: '#1c2526', borderRadius: 2, p: 3, boxShadow: '0 4px 16px rgba(0, 0, 0, 0.5)' }}>
                        <Typography variant="subtitle1" sx={{ color: '#fff', mb: 2, fontWeight: 'medium' }}>
                            ‚ÑπÔ∏è Informa√ß√µes do Sistema
                        </Typography>
                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1, color: '#b0bec5' }}>
                            <Typography variant="caption">üî• Base de dados: Firebase Realtime</Typography>
                            <Typography variant="caption">üì± Modo: Coleta de dados mobile</Typography>
                            <Typography variant="caption">üåç Foco: Vigil√¢ncia epidemiol√≥gica</Typography>
                            <Typography variant="caption">üîí Requer: Permiss√£o de localiza√ß√£o</Typography>
                        </Box>
                    </Card>
                </Box>
            );
        };

        ReactDOM.render(<ColeraTracker />, document.getElementById('root'));
    </script>
</body>
</html>
