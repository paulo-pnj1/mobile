<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rastreador de C√≥lera - Mobile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body { 
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .icon {
            width: 18px;
            height: 18px;
            display: inline-block;
            vertical-align: middle;
        }
        .icon-lg {
            width: 24px;
            height: 24px;
        }
        .icon-xl {
            width: 32px;
            height: 32px;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .button-primary {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        .button-success {
            background: linear-gradient(45deg, #059669, #10b981);
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
        }
        .button-danger {
            background: linear-gradient(45deg, #dc2626, #ef4444);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // √çcones SVG
        const BiohazardIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v-.07zM17.9 17.39c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
            </svg>
        );

        const MapIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const ActivityIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
            </svg>
        );

        const UserIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const PlayIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5,3 19,12 5,21"></polygon>
            </svg>
        );

        const StopIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="6" width="12" height="12"></rect>
            </svg>
        );

        const SendIcon = ({ className = "icon" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
            </svg>
        );

        const ColeraTracker = () => {
            const [isTracking, setIsTracking] = useState(false);
            const [location, setLocation] = useState(null);
            const [lastSent, setLastSent] = useState(null);
            const [status, setStatus] = useState('Aguardando');
            const [error, setError] = useState(null);
            const [watchId, setWatchId] = useState(null);
            const [caseData, setCaseData] = useState({
                agenteName: '',
                caseType: 'suspeito',
                severity: 'leve'
            });

            const FIREBASE_URL = 'https://vigicolera-default-rtdb.firebaseio.com/casos-colera.json';

            const sendCaseToFirebase = async (lat, lng, caseInfo) => {
                try {
                    const data = {
                        agente: caseInfo.agenteName || "agente-campo",
                        dispositivo: "mobile-coleta",
                        tipoCaso: caseInfo.caseType,
                        gravidade: caseInfo.severity,
                        coordenadas: {
                            lat: lat.toString(),
                            lng: lng.toString(),
                            precisao: location?.accuracy || 0
                        },
                        timestamp: new Date().toISOString(),
                        dataHora: new Date().toLocaleString('pt-BR'),
                        status: "pendente-analise"
                    };

                    const response = await fetch(FIREBASE_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        setLastSent(new Date().toLocaleTimeString());
                        setStatus('‚úÖ Caso registrado com sucesso');
                        setError(null);
                        // Vibra√ß√£o de feedback
                        if (navigator.vibrate) {
                            navigator.vibrate([100, 50, 100]);
                        }
                    } else {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                } catch (err) {
                    setError(`‚ùå Erro ao registrar: ${err.message}`);
                    setStatus('Erro no registro');
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }
                }
            };

            const handleLocationUpdate = (position) => {
                const { latitude, longitude } = position.coords;
                setLocation({
                    lat: latitude,
                    lng: longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date()
                });
            };

            const handleLocationError = (error) => {
                let errorMessage = '';
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage = "‚ùå Permiss√£o de localiza√ß√£o negada";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage = "‚ùå GPS indispon√≠vel";
                        break;
                    case error.TIMEOUT:
                        errorMessage = "‚è±Ô∏è Timeout do GPS";
                        break;
                    default:
                        errorMessage = "‚ùå Erro desconhecido";
                        break;
                }
                setError(errorMessage);
                setStatus('Erro GPS');
            };

            const startTracking = () => {
                if (!navigator.geolocation) {
                    setError('‚ùå GPS n√£o suportado');
                    return;
                }

                const options = {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 60000
                };

                const id = navigator.geolocation.watchPosition(
                    handleLocationUpdate,
                    handleLocationError,
                    options
                );

                setWatchId(id);
                setIsTracking(true);
                setStatus('üîÑ Rastreando localiza√ß√£o...');
                setError(null);
            };

            const stopTracking = () => {
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    setWatchId(null);
                }
                setIsTracking(false);
                setStatus('‚èπÔ∏è Rastreamento parado');
            };

            const registerCase = () => {
                if (!location) {
                    setError('‚ùå Localiza√ß√£o necess√°ria para registrar caso');
                    return;
                }

                if (!caseData.agenteName.trim()) {
                    setError('‚ùå Nome do agente √© obrigat√≥rio');
                    return;
                }

                setStatus('üìù Registrando caso...');
                sendCaseToFirebase(location.lat, location.lng, caseData);
            };

            const getCurrentLocation = () => {
                if (!navigator.geolocation) {
                    setError('‚ùå GPS n√£o suportado');
                    return;
                }

                setStatus('üìç Obtendo localiza√ß√£o atual...');
                navigator.geolocation.getCurrentPosition(
                    handleLocationUpdate,
                    handleLocationError,
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    }
                );
            };

            useEffect(() => {
                // Auto-obter localiza√ß√£o na inicializa√ß√£o
                getCurrentLocation();
                
                return () => {
                    if (watchId) {
                        navigator.geolocation.clearWatch(watchId);
                    }
                };
            }, []);

            return (
                <div className="min-h-screen p-4">
                    {/* Header */}
                    <div className="text-center mb-6 slide-up">
                        <div className="glass-effect rounded-2xl p-6 mb-4">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                <BiohazardIcon className="icon-xl text-red-600" />
                                <h1 className="text-2xl font-bold text-gray-800">
                                    Vigil√¢ncia C√≥lera
                                </h1>
                            </div>
                            <p className="text-gray-600 text-sm">Sistema de Coleta de Dados Mobile</p>
                        </div>
                    </div>

                    {/* Status Card */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center justify-between mb-3">
                            <span className="text-sm font-semibold text-gray-700">Status do Sistema:</span>
                            <ActivityIcon className={`icon-lg ${isTracking ? 'text-green-500 pulse-animation' : 'text-gray-400'}`} />
                        </div>
                        
                        <div className={`text-lg font-semibold mb-2 ${
                            status.includes('sucesso') ? 'text-green-600' : 
                            status.includes('Erro') ? 'text-red-600' : 'text-blue-600'
                        }`}>
                            {status}
                        </div>
                        
                        {lastSent && (
                            <div className="text-xs text-gray-500">
                                √öltimo registro: {lastSent}
                            </div>
                        )}
                    </div>

                    {/* Agent Info */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <div className="flex items-center gap-2 mb-3">
                            <UserIcon className="icon text-blue-600" />
                            <span className="font-semibold text-gray-700">Dados do Agente</span>
                        </div>
                        
                        <input
                            type="text"
                            placeholder="Nome do agente de campo"
                            value={caseData.agenteName}
                            onChange={(e) => setCaseData({...caseData, agenteName: e.target.value})}
                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-lg"
                        />
                    </div>

                    {/* Case Data */}
                    <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                        <h3 className="font-semibold text-gray-700 mb-3">üìã Dados do Caso</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-2">Tipo de Caso:</label>
                                <select
                                    value={caseData.caseType}
                                    onChange={(e) => setCaseData({...caseData, caseType: e.target.value})}
                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-lg"
                                >
                                    <option value="suspeito">ü§î Caso Suspeito</option>
                                    <option value="confirmado">‚úÖ Caso Confirmado</option>
                                    <option value="descartado">‚ùå Caso Descartado</option>
                                </select>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-2">Gravidade:</label>
                                <select
                                    value={caseData.severity}
                                    onChange={(e) => setCaseData({...caseData, severity: e.target.value})}
                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-lg"
                                >
                                    <option value="leve">üü¢ Leve</option>
                                    <option value="moderado">üü° Moderado</option>
                                    <option value="grave">üî¥ Grave</option>
                                    <option value="critico">üÜò Cr√≠tico</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    {/* Location Info */}
                    {location && (
                        <div className="glass-effect rounded-2xl p-4 mb-4 slide-up">
                            <div className="flex items-center gap-2 mb-3">
                                <MapIcon className="icon text-green-600" />
                                <span className="font-semibold text-gray-700">Localiza√ß√£o Atual</span>
                            </div>
                            
                            <div className="text-sm text-gray-600 space-y-2">
                                <div className="flex justify-between">
                                    <span>Latitude:</span>
                                    <span className="font-mono">{location.lat.toFixed(6)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Longitude:</span>
                                    <span className="font-mono">{location.lng.toFixed(6)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Precis√£o:</span>
                                    <span className="font-mono">{location.accuracy?.toFixed(0)}m</span>
                                </div>
                                <div className="text-xs text-gray-500 text-center pt-2">
                                    Atualizado: {location.timestamp.toLocaleString()}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Error Message */}
                    {error && (
                        <div className="glass-effect rounded-2xl p-4 mb-4 border-2 border-red-200 slide-up">
                            <p className="text-red-700 font-medium text-center">{error}</p>
                        </div>
                    )}

                    {/* Main Action Button */}
                    <div className="mb-4 slide-up">
                        <button
                            onClick={registerCase}
                            disabled={!location || !caseData.agenteName.trim()}
                            className="w-full button-primary disabled:bg-gray-300 disabled:shadow-none text-white font-bold py-6 px-4 rounded-2xl transition-all duration-300 flex items-center justify-center gap-3 text-xl"
                        >
                            <SendIcon className="icon-lg" />
                            üìù REGISTRAR CASO
                        </button>
                    </div>

                    {/* GPS Controls */}
                    <div className="grid grid-cols-2 gap-3 mb-6 slide-up">
                        <button
                            onClick={getCurrentLocation}
                            className="button-primary text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 flex items-center justify-center gap-2"
                        >
                            <MapIcon className="icon" />
                            üìç Localizar
                        </button>
                        
                        {!isTracking ? (
                            <button
                                onClick={startTracking}
                                className="button-success text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 flex items-center justify-center gap-2"
                            >
                                <PlayIcon className="icon" />
                                ‚ñ∂Ô∏è Rastrear
                            </button>
                        ) : (
                            <button
                                onClick={stopTracking}
                                className="button-danger text-white font-semibold py-4 px-4 rounded-xl transition-all duration-300 flex items-center justify-center gap-2"
                            >
                                <StopIcon className="icon" />
                                ‚èπÔ∏è Parar
                            </button>
                        )}
                    </div>

                    {/* Info Footer */}
                    <div className="glass-effect rounded-2xl p-4 slide-up">
                        <h4 className="font-semibold text-gray-700 mb-3">‚ÑπÔ∏è Informa√ß√µes do Sistema</h4>
                        <div className="text-xs text-gray-600 space-y-1">
                            <div>üî• Base de dados: Firebase Realtime</div>
                            <div>üì± Modo: Coleta de dados mobile</div>
                            <div>üåç Foco: Vigil√¢ncia epidemiol√≥gica</div>
                            <div>üîí Requer: Permiss√£o de localiza√ß√£o</div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ColeraTracker />, document.getElementById('root'));
    </script>
</body>
</html>
